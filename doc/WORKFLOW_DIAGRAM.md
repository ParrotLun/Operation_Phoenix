# å·¥ä½œæµç¨‹è¦–è¦ºåŒ–åœ–è¡¨

## ğŸ¨ å®Œæ•´ Message æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        OPERATION PHOENIX WORKFLOW                           â”‚
â”‚                  "è«‹è®€å– msg.txt ä¸¦ç”¢ç”Ÿ DATCOM æª”æ¡ˆ"                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ‘¤ User
  â”‚
  â”‚ #1: HumanMessage
  â”‚ "è«‹è®€å– msg.txt ä¸¦ç”¢ç”Ÿ DATCOM æª”æ¡ˆ"
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SUPERVISOR            â”‚  state.file_content = None
â”‚   (åˆ†æè«‹æ±‚)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”‚ #2: AIMessage + Tool Call
  â”‚ transfer_to_read_file_agent()
  â”‚ ğŸ’­ "éœ€è¦å…ˆè®€æª”æ¡ˆï¼Œç„¶å¾Œç”¢ç”Ÿ DATCOM"
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SYSTEM                â”‚  #3: ToolMessage
â”‚   (åŸ·è¡Œè·¯ç”±)            â”‚  "Successfully transferred"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”‚ æ§åˆ¶æ¬Šè½‰ç§»
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   READ_FILE_AGENT       â”‚  state.file_content = None
â”‚   (è®€å–æª”æ¡ˆ)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”‚ #4: AIMessage + Tool Call
  â”‚ read_file("msg.txt")
  â”‚ ğŸ“„ è®€å– 949 å­—å…ƒ
  â”‚
  â”‚ ğŸ”‘ STATE UPDATE: state.file_content = "## PC-9 é£›æ©Ÿ..."
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   READ_FILE_AGENT       â”‚  state.file_content = "## PC-9..."
â”‚   (å®Œæˆï¼Œæº–å‚™è¿”å›)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”‚ #5: AIMessage + Tool Call
  â”‚ transfer_back_to_supervisor()
  â”‚ "Transferring back to supervisor"
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SYSTEM                â”‚  #6: ToolMessage
â”‚   (åŸ·è¡Œè¿”å›)            â”‚  "Successfully transferred back"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”‚ æ§åˆ¶æ¬Šè¿”å›
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SUPERVISOR            â”‚  state.file_content = "## PC-9..." âœ…
â”‚   (å†æ¬¡åˆ†æ)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”‚ #7: AIMessage + Tool Call
  â”‚ transfer_to_datcom_tool_agent()
  â”‚ ğŸ’­ "æª”æ¡ˆå·²è®€å–ï¼Œç¾åœ¨ç”¢ç”Ÿ DATCOM"
  â”‚ ğŸ’­ "state.file_content æœ‰è³‡æ–™äº†"
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SYSTEM                â”‚  #8: ToolMessage
â”‚   (åŸ·è¡Œç¬¬äºŒæ¬¡è·¯ç”±)      â”‚  "Successfully transferred"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”‚ æ§åˆ¶æ¬Šè½‰ç§»
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DATCOM_TOOL_AGENT     â”‚  state.file_content = "## PC-9..." âœ…
â”‚   (ç”¢ç”Ÿ DATCOM)         â”‚  ğŸ” LLM æª¢æŸ¥ state.file_content
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”‚ #9: AIMessage + Tool Call
  â”‚ write_datcom_file(
  â”‚   nalpha=6,
  â”‚   alschd="1.0,2.0,3.0,4.0,5.0,6.0",
  â”‚   nmach=1,
  â”‚   ... 57 parameters ...
  â”‚ )
  â”‚ ğŸ“ ç”¢ç”Ÿ for005.dat
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DATCOM_TOOL_AGENT     â”‚
â”‚   (å®Œæˆï¼Œæº–å‚™è¿”å›)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”‚ #10: AIMessage + Tool Call
  â”‚ transfer_back_to_supervisor()
  â”‚ "Transferring back to supervisor"
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SYSTEM                â”‚  #11: ToolMessage
â”‚   (åŸ·è¡Œç¬¬äºŒæ¬¡è¿”å›)      â”‚  "Successfully transferred back"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”‚ æ§åˆ¶æ¬Šå†æ¬¡è¿”å›
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SUPERVISOR            â”‚
â”‚   (ç¢ºèªå®Œæˆ)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”‚ #12: AIMessage
  â”‚ "âœ… å·²å®Œæˆï¼for005.dat å·²ç”Ÿæˆ..."
  â”‚
  â–¼
ğŸ‘¤ User
   (æ”¶åˆ°å›æ‡‰)
```

## ğŸ“Š State è®ŠåŒ–æ™‚é–“ç·š

```
Message #  â”‚ Location           â”‚ Action                 â”‚ state.file_content
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
#1         â”‚ User â†’ System      â”‚ ç™¼é€è«‹æ±‚               â”‚ None
#2         â”‚ Supervisor         â”‚ æ±ºå®šè·¯ç”±åˆ° read_file   â”‚ None
#3         â”‚ System             â”‚ åŸ·è¡Œ transfer          â”‚ None
#4         â”‚ read_file_agent    â”‚ è®€å– msg.txt           â”‚ None â†’ "## PC-9..." âœ…
#5         â”‚ read_file_agent    â”‚ æº–å‚™è¿”å›               â”‚ "## PC-9..."
#6         â”‚ System             â”‚ åŸ·è¡Œ transfer_back     â”‚ "## PC-9..." âœ… å·²è¨­å®š
#7         â”‚ Supervisor         â”‚ æ±ºå®šè·¯ç”±åˆ° datcom      â”‚ "## PC-9..." âœ… å¯è¦‹
#8         â”‚ System             â”‚ åŸ·è¡Œ transfer          â”‚ "## PC-9..."
#9         â”‚ datcom_tool_agent  â”‚ è®€å– state ä¸¦ç”¢ç”Ÿæª”æ¡ˆ  â”‚ "## PC-9..." âœ… LLM è®€å–
#10        â”‚ datcom_tool_agent  â”‚ æº–å‚™è¿”å›               â”‚ "## PC-9..."
#11        â”‚ System             â”‚ åŸ·è¡Œ transfer_back     â”‚ "## PC-9..."
#12        â”‚ Supervisor         â”‚ å›æ‡‰ä½¿ç”¨è€…             â”‚ "## PC-9..."
```

## ğŸ”„ è³‡æ–™æµå‘åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATA FLOW DIAGRAM                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Input
    â”‚
    â”‚ "è«‹è®€å– msg.txt ä¸¦ç”¢ç”Ÿ DATCOM æª”æ¡ˆ"
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUPERVISOR (create_supervisor)                                   â”‚
â”‚  - state_schema=SupervisorState                                   â”‚
â”‚  - ç¶­è­·å…±äº« state                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â”€â”€ Route 1: read_file_agent â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                               â”‚
    â–¼                                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  READ_FILE_AGENT                          â”‚      â”‚
â”‚  - graph (from read_file_agent/agent.py)  â”‚      â”‚
â”‚  - ä½¿ç”¨ SupervisorState                   â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
    â”‚                                               â”‚
    â”‚ read_file("msg.txt")                          â”‚
    â”‚      â”‚                                        â”‚
    â”‚      â”œâ”€ è®€å–æª”æ¡ˆç³»çµ±                          â”‚
    â”‚      â”‚  /read_file_agent/data/msg.txt        â”‚
    â”‚      â”‚                                        â”‚
    â”‚      â–¼                                        â”‚
    â”‚  content = """                                â”‚
    â”‚  ## PC-9 é£›æ©Ÿ DATCOM é…ç½®                     â”‚
    â”‚  NALPHA=6                                     â”‚
    â”‚  ...                                          â”‚
    â”‚  """                                          â”‚
    â”‚                                               â”‚
    â”‚ return {"file_content": content}              â”‚
    â”‚      â”‚                                        â”‚
    â”‚      â–¼                                        â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
    â”‚  â”‚  SUPERVISOR STATE UPDATE            â”‚     â”‚
    â”‚  â”‚  state.file_content = content       â”‚â—„â”€â”€â”€â”€â”˜
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚
    â”œâ”€â”€â”€ Route 2: datcom_tool_agent â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                              â”‚
    â–¼                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  DATCOM_TOOL_AGENT                        â”‚     â”‚
â”‚  - create_react_agent                     â”‚     â”‚
â”‚  - state_schema=SupervisorState âœ…        â”‚     â”‚
â”‚  - prompt æç¤ºæª¢æŸ¥ state.file_content     â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
    â”‚                                              â”‚
    â”‚ LLM è®€å– state.file_content                  â”‚
    â”‚      â”‚                                       â”‚
    â”‚      â–¼                                       â”‚
    â”‚  content = state.file_content  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  = "## PC-9 é£›æ©Ÿ DATCOM é…ç½®..."
    â”‚
    â”‚ LLM è§£æ content
    â”‚      â”‚
    â”‚      â”œâ”€ æå– nalpha=6
    â”‚      â”œâ”€ æå– alschd="1.0,2.0,3.0,4.0,5.0,6.0"
    â”‚      â”œâ”€ æå– nmach=1
    â”‚      â”œâ”€ ... (å…± 57 å€‹åƒæ•¸)
    â”‚      â”‚
    â”‚      â–¼
    â”‚  write_datcom_file(
    â”‚    nalpha=6,
    â”‚    alschd="1.0,2.0,3.0,4.0,5.0,6.0",
    â”‚    nmach=1,
    â”‚    ...
    â”‚  )
    â”‚      â”‚
    â”‚      â–¼
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚  DATCOM GENERATOR                   â”‚
    â”‚  â”‚  (run_generator.py)                 â”‚
    â”‚  â”‚  - æ ¼å¼åŒ–æ•¸å­—                       â”‚
    â”‚  â”‚  - ç”¢ç”Ÿ namelist æ ¼å¼               â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚      â”‚
    â”‚      â–¼
    â”‚  å¯«å…¥æª”æ¡ˆç³»çµ±
    â”‚  /datcom_tool_agent/output/for005.dat
    â”‚
    â–¼
Response to User
"âœ… å·²å®Œæˆï¼for005.dat å·²ç”Ÿæˆ..."
```

## ğŸ”‘ é—œéµæŠ€è¡“é»åœ–è§£

### 1. State Schema å…±äº«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SupervisorState (supervisor_agent/utils/state.py)           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  class SupervisorState(MessagesState):                       â”‚
â”‚      file_content: Optional[str] = None  â† å…±äº«æ¬„ä½          â”‚
â”‚      next: Optional[str] = None                              â”‚
â”‚      remaining_steps: int = 25                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ æ‰€æœ‰ agents ä½¿ç”¨ç›¸åŒçš„ state schema
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUPERVISOR   â”‚  â”‚ READ_FILE     â”‚  â”‚ DATCOM_TOOL   â”‚
â”‚               â”‚  â”‚ AGENT         â”‚  â”‚ AGENT         â”‚
â”‚ state_schema= â”‚  â”‚ (uses         â”‚  â”‚ state_schema= â”‚
â”‚ Supervisor    â”‚  â”‚  supervisor   â”‚  â”‚ Supervisor    â”‚
â”‚ State         â”‚  â”‚  state)       â”‚  â”‚ State âœ…      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                     å…±äº«çš„ State å¯¦ä¾‹
                  state.file_content = "..."
```

### 2. Transfer æ©Ÿåˆ¶

```
Agent å®Œæˆä»»å‹™å¾Œçš„è¿”å›æµç¨‹ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agent (e.g., read_file)â”‚
â”‚  å®Œæˆä»»å‹™                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ æ±ºå®šè¦è¿”å› Supervisor
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AIMessage              â”‚
â”‚  Content:               â”‚
â”‚  "Transferring back"    â”‚
â”‚                         â”‚
â”‚  Tool Call:             â”‚
â”‚  transfer_back_to_      â”‚
â”‚  supervisor()           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SYSTEM                 â”‚
â”‚  åŸ·è¡Œ tool call         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ToolMessage            â”‚
â”‚  "Successfully          â”‚
â”‚   transferred back"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUPERVISOR             â”‚
â”‚  æ§åˆ¶æ¬Šè¿”å›             â”‚
â”‚  ç¹¼çºŒæ±ºç­–               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. LLM å¦‚ä½•è®€å– State

```
datcom_tool_agent åŸ·è¡Œæ™‚ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LangGraph Context                                       â”‚
â”‚                                                         â”‚
â”‚ messages = [                                            â”‚
â”‚   HumanMessage("è«‹è®€å–..."),                            â”‚
â”‚   ...                                                   â”‚
â”‚ ]                                                       â”‚
â”‚                                                         â”‚
â”‚ state = {                                               â”‚
â”‚   "messages": [...],                                    â”‚
â”‚   "file_content": "## PC-9 é£›æ©Ÿ..."  â† LLM å¯ä»¥çœ‹åˆ°    â”‚
â”‚ }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ å‚³çµ¦ LLM
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLM (gpt-oss-20b)                                       â”‚
â”‚                                                         â”‚
â”‚ System Prompt:                                          â”‚
â”‚ "You are a DATCOM file generation specialist.          â”‚
â”‚  Check if there is file content in state.file_content" â”‚
â”‚                                                         â”‚
â”‚ LLM æ€è€ƒéç¨‹:                                           â”‚
â”‚ 1. æª¢æŸ¥ prompt â†’ "Check state.file_content"            â”‚
â”‚ 2. æŸ¥çœ‹ context â†’ state.file_content = "## PC-9..."    â”‚
â”‚ 3. æœ‰è³‡æ–™ï¼ä½¿ç”¨é€™å€‹ä¾†æå–åƒæ•¸                          â”‚
â”‚ 4. è§£æ "NALPHA=6" â†’ nalpha=6                          â”‚
â”‚ 5. è§£æ "ALSCHD=..." â†’ alschd="1.0,2.0,..."            â”‚
â”‚ 6. ... æå–æ‰€æœ‰ 57 å€‹åƒæ•¸                               â”‚
â”‚ 7. å‘¼å« write_datcom_file(nalpha=6, ...)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tool Execution                                          â”‚
â”‚ write_datcom_file(...57 parameters...)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ æ•ˆèƒ½æ¯”è¼ƒ

### ç•¶å‰æ¶æ§‹ (12 Messages) âœ…

```
å„ªé»:
âœ… åŠŸèƒ½å®Œæ•´ - æ‰€æœ‰æ­¥é©Ÿéƒ½åŸ·è¡Œ
âœ… ç‹€æ…‹æ¸…æ¥š - æ¯å€‹ transfer éƒ½æœ‰è¨˜éŒ„
âœ… å¯è¿½è¹¤æ€§ - å®Œæ•´çš„ message history
âœ… éŒ¯èª¤è™•ç† - æ¯æ­¥å¯ç¨ç«‹è™•ç†éŒ¯èª¤
âœ… éˆæ´»æ€§é«˜ - Supervisor å¯æ™ºèƒ½è·¯ç”±

ç¼ºé»:
âš ï¸ Messages è¼ƒå¤š (12 å€‹)
âš ï¸ åŸ·è¡Œæ™‚é–“ ~5-8 ç§’

é©ç”¨: âœ… ç”Ÿç”¢ç’°å¢ƒ
```

### å„ªåŒ–æ¶æ§‹ (5 Messages with add_handoff_back_messages=False) âŒ

```
å„ªé»:
âœ… Messages è¼ƒå°‘ (5 å€‹)
âœ… åŸ·è¡Œæ›´å¿«

ç¼ºé»:
âŒ å¤šæ­¥é©Ÿå·¥ä½œæµç¨‹ä¸­æ–·
âŒ åªåŸ·è¡Œç¬¬ä¸€æ­¥ (read_file)
âŒ ä¸åŸ·è¡Œç¬¬äºŒæ­¥ (datcom)
âŒ ç„¡æ³•ç”¢ç”Ÿ DATCOM æª”æ¡ˆ

é©ç”¨: âŒ ä¸é©ç”¨ï¼ˆåŠŸèƒ½æå£ï¼‰
```

### å°ˆç”¨ Agent (5-6 Messages) ğŸ¤”

```
å„ªé»:
âœ… æ›´å¿«
âœ… åŠŸèƒ½å®Œæ•´

ç¼ºé»:
âš ï¸ å¤±å»éˆæ´»æ€§
âš ï¸ åªèƒ½è™•ç†å›ºå®šæµç¨‹
âš ï¸ éœ€è¦é¡å¤–ç¶­è­·

é©ç”¨: ğŸ¤” ç‰¹å®šå ´æ™¯ï¼ˆé«˜é »å›ºå®šæµç¨‹ï¼‰
```

## ğŸ¯ ç¸½çµ

### 12 å€‹ Messages = 2 æ¬¡å®Œæ•´çš„ Agent è·¯ç”±

```
User â†’ Supervisor â†’ read_file_agent â†’ Supervisor â†’ datcom_tool_agent â†’ User
 1         2-6             7-11                      12
```

### State å‚³éçš„æ ¸å¿ƒ

```
read_file_agent è¨­å®š â†’ state.file_content â†’ datcom_tool_agent è®€å–
                              â†‘
                        å…±äº«çš„ State
                     (SupervisorState)
```

### é—œéµè¨­å®šæª¢æŸ¥æ¸…å–®

- âœ… `supervisor` è¨­å®š `state_schema=SupervisorState`
- âœ… `datcom_tool_agent` è¨­å®š `state_schema=SupervisorState`
- âœ… `datcom_tool_agent` prompt æç¤º "Check state.file_content"
- âœ… `read_file_agent` è¿”å› `{"file_content": content}`

---

**ç›¸é—œæ–‡ä»¶**:
- [WORKFLOW_EXPLAINED.md](WORKFLOW_EXPLAINED.md) - è©³ç´°æ–‡å­—èªªæ˜
- [SYSTEM_STATUS.md](SYSTEM_STATUS.md) - ç³»çµ±ç‹€æ…‹
- [OPTIMIZATION_RESULTS.md](OPTIMIZATION_RESULTS.md) - å„ªåŒ–æ¸¬è©¦çµæœ
